{% extends 'base.html' %}

{% block content %}
     <main class="main-content">
      <section class="patient-info">
    <!-- Change Password and Edit Button -->
      {% if request.user.pk == object.pk %}
          <div class="edit-button-wrapper">
            <a href="{% url 'edit-profile' object.pk %}">
                <button class="edit-button">Обработи</button>
            </a><a href="{% url 'change-password' request.user.pk %}">
                <button class="change-password-button">Смяна на Парола</button>
            </a>
          </div>
      {% endif %}
      <!-- Profile Info -->
          <ul>
              {% include 'common/profile-details-fields.html' %}
          </ul>
      <!-- Delete Button  -->  
      {% if request.user.is_dentist or request.user.pk == object.pk %}
          <div class="delete-button-wrapper">
              <a href="{% url 'delete-profile' object.pk %}">
                <button class="delete-button">Изтрий</button>
              </a>
          </div>
      {% endif %}
      </section>
    <!-- Visit Info -->
     {% if request.user.is_patient %}
      <h3>Вашите Посещения</h3>
         {% include 'visits/visits-list.html' %}
     {% endif %}
    <!-- Set Availability buttons -->
     {% if request.user.is_dentist and request.user.pk == object.pk %}
         <div class="availability-buttons">
             <a href="{% url 'availability' %}">
                <button class="set-availability-button mb-4" >Работно Време</button>
             </a>
             <a href="{% url 'unavailability' %}">
                <button class="set-availability-button mb-4" >Почивни Дни</button>
             </a>
         </div>
     {% endif %}
    <!-- Current availabilities  -->
     {% if request.user.is_dentist or request.user.is_nurse %}
         <h3>Работни Дни</h3>
         <ul class="appointments-ul">
            
             {% for a in availabilities %}
                 {% if a.type == 'available' %}
                    <li>
                        <a href="{% url 'availability-details' a.obj.pk %}">
                            Работно Време: {{ a.obj.get_weekday_labels|join:", " }} - 
                            от {{ a.obj.start_time|time:"H:i" }} до {{ a.obj.end_time|time:"H:i" }} 
                            от {{ a.obj.valid_from|date:"d.m.Y" }} до {{ a.obj.valid_to|date:"d.m.Y" }} 
                        </a>
                    </li>
                 {% elif a.type == 'unavailable' %}
                     <li>
                        <a href="{% url 'unavailability-details' a.obj.pk %}">
                            Почивни дни: от {{ a.obj.start_date|date:"d.m.Y" }} до {{ a.obj.end_date|date:"d.m.Y" }} 
                             - Причина: {{ a.obj.reason|default:"Няма" }}
                        </a>
                    </li>
                 {% else %}
                     <li>
                        Нямате зададено работно време или почивни дни
                    </li>
                 {% endif %}
             {% endfor %}
         
         </ul>
     {% endif %}
    {% include 'pagination.html' %}
  </main>
{% endblock %}